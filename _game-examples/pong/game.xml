<?xml version="1.0" encoding="UTF-8"?>
<game aspectRatio="4:3" name="Pong">
  <scene name="MainMenu" type="ui" firstScene="true" backgroundColor="#0b1224">
    <html>
      <![CDATA[
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:20px;color:#ffffff;font-family:'Courier New',monospace;text-align:center;">
          <h1 style="font-size:48px;margin:0;letter-spacing:6px;">PONG</h1>
          <p style="opacity:0.8;font-size:18px;">Player 1: W / S &nbsp;•&nbsp; Player 2: Arrow Keys</p>
          <button id="start-btn">Start Match</button>
        </div>
      ]]>
    </html>
    <script>
      <![CDATA[
        const $ = (sel) => root.querySelector(sel)
        $('#start-btn')?.addEventListener('click', () => {
          sceneManager.pushScene('Gameplay')
        })
      ]]>
    </script>
  </scene>

  <scene name="Gameplay" type="composite">
    <scene type="2d" name="GameWorld" backgroundColor="#081631">
      <entity name="Camera">
        <component type="Transform" x="10" y="10"/>
        <component type="Camera"/>
      </entity>

      <entity name="TopWall">
        <component type="Transform" x="10" y="19.5"/>
        <component type="Rect" width="23" height="0.5" color="#1e3a8a" opacity="0.6"/>
      </entity>
      <entity name="BottomWall">
        <component type="Transform" x="10" y="0.5"/>
        <component type="Rect" width="23" height="0.5" color="#1e3a8a" opacity="0.6"/>
      </entity>

      <entity name="LeftPaddle">
        <component type="Transform" x="-0.5" y="10"/>
        <component type="Rect" width="0.6" height="3" color="#e2e8f0"/>
        <component type="Paddle" side="left" speed="16"/>
      </entity>

      <entity name="RightPaddle">
        <component type="Transform" x="20.5" y="10"/>
        <component type="Rect" width="0.6" height="3" color="#e2e8f0"/>
        <component type="Paddle" side="right" speed="16"/>
      </entity>

      <entity name="Ball">
        <component type="Transform" x="10" y="10"/>
        <component type="Circle" radius="0.35" color="#f8fafc"/>
        <component type="Ball" velocityX="0" velocityY="0" speed="0"/>
      </entity>
    </scene>

    <scene name="HUD" type="ui" backgroundColor="transparent" suspendBehind="false">
      <html>
        <![CDATA[
          <div style="position:absolute;top:24px;left:50%;transform:translateX(-50%);color:#ffffff;font-family:'Courier New',monospace;display:flex;gap:48px;align-items:center;font-size:28px;">
            <div>Player 1: <span id="hud-left-score">0</span></div>
            <div>Player 2: <span id="hud-right-score">0</span></div>
          </div>
          <div style="position:absolute;bottom:28px;left:50%;transform:translateX(-50%);color:#94a3b8;font-family:'Courier New',monospace;font-size:16px;text-align:center;">
            Press Escape to pause
          </div>
        ]]>
      </html>
      <script>
        <![CDATA[
          const $ = (sel) => root.querySelector(sel)
          const updateScores = () => {
            $('#hud-left-score').textContent = GlobalState.get('leftScore') ?? 0
            $('#hud-right-score').textContent = GlobalState.get('rightScore') ?? 0
          }
          updateScores()
          const unwatchLeft = GlobalState.watch('leftScore', updateScores)
          const unwatchRight = GlobalState.watch('rightScore', updateScores)
          return () => {
            unwatchLeft()
            unwatchRight()
          }
        ]]>
      </script>
    </scene>
  </scene>

  <scene name="PauseMenu" type="ui" backgroundColor="rgba(0,0,0,0.85)" suspendBehind="true">
    <html>
      <![CDATA[
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:18px;color:#ffffff;font-family:'Courier New',monospace;">
          <h2 style="font-size:36px;margin:0;letter-spacing:4px;">PAUSED</h2>
          <button id="resume-btn">Resume</button>
          <button id="menu-btn">Exit to Menu</button>
        </div>
      ]]>
    </html>
    <script>
      <![CDATA[
        const $ = (sel) => root.querySelector(sel)
        $('#resume-btn')?.addEventListener('click', () => sceneManager.popScene())
        $('#menu-btn')?.addEventListener('click', () => {
          sceneManager.popScene() // Pause
          sceneManager.popScene() // Gameplay composite
        })
      ]]>
    </script>
  </scene>

  <scene name="GameOver" type="ui" backgroundColor="rgba(5,8,20,0.92)" suspendBehind="true">
    <html>
      <![CDATA[
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:20px;color:#ffffff;font-family:'Courier New',monospace;text-align:center;">
          <h2 style="font-size:48px;margin:0;color:#38bdf8;letter-spacing:4px;">MATCH OVER</h2>
          <div style="font-size:22px;">Winner: <span id="winner-name">--</span></div>
          <div style="font-size:18px;">Final Score<br/><span id="final-score">0 - 0</span></div>
          <div style="display:flex;gap:16px;margin-top:12px;">
            <button id="restart-btn">Play Again</button>
            <button id="menu-btn-go">Main Menu</button>
          </div>
        </div>
      ]]>
    </html>
    <script>
      <![CDATA[
        const $ = (sel) => root.querySelector(sel)
        const left = GlobalState.get('leftScore') ?? 0
        const right = GlobalState.get('rightScore') ?? 0
        const winner = GlobalState.get('matchWinner') ?? '—'
        $('#winner-name').textContent = winner === 'left' ? 'Player 1' : winner === 'right' ? 'Player 2' : '—'
        $('#final-score').textContent = `${left} - ${right}`

        $('#restart-btn')?.addEventListener('click', () => {
          EventBus.emit('game:restart-match')
          sceneManager.popScene()
        })
        $('#menu-btn-go')?.addEventListener('click', () => {
          sceneManager.popScene() // GameOver
          sceneManager.popScene() // Gameplay
        })
      ]]>
    </script>
  </scene>

  <style>
    <![CDATA[
      button {
        appearance: none;
        -webkit-appearance: none;
        background: #38bdf8;
        color: #0f172a;
        border: 2px solid #0ea5e9;
        padding: 12px 28px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 16px;
        font-weight: bold;
        letter-spacing: 1px;
        box-shadow: 0 4px 0 #0369a1, 0 6px 12px rgba(15,23,42,0.6);
        transition: all .12s ease;
        cursor: pointer;
        text-transform: uppercase;
      }
      button:hover {
        background: #7dd3fc;
        transform: translateY(-2px);
        box-shadow: 0 6px 0 #0369a1, 0 10px 18px rgba(15,23,42,0.45);
      }
      button:active {
        background: #0ea5e9;
        transform: translateY(2px);
        box-shadow: 0 2px 0 #0369a1, 0 4px 10px rgba(15,23,42,0.4);
      }
      button:focus-visible {
        outline: 3px solid #7dd3fc;
        outline-offset: 4px;
      }
    ]]>
  </style>
</game>
